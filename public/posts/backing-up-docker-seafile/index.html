<!DOCTYPE html>
<html lang="en-us">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Properly backing up Docker Seafile&#39;s database | 000yesnt.github.io</title>
<meta name="title" content="Properly backing up Docker Seafile&#39;s database" />
<meta name="description" content="I wrote this post before I moved away from Seafile. I won&rsquo;t be updating it, but the commands here should still work as long as Seafile continues to use MySQL/MariaDB.
The Seafile Admin Manual recommends using the following commands to backup your database container:
cd /backup/databases docker exec -it seafile-mysql mariadb-dump -u[username] -p[password] --opt ccnet_db &gt; ccnet_db.sql docker exec -it seafile-mysql mariadb-dump -u[username] -p[password] --opt seafile_db &gt; seafile_db.sql docker exec -it seafile-mysql mariadb-dump -u[username] -p[password] --opt seahub_db &gt; seahub_db." />
<meta name="author" content="" />
<meta name="keywords" content="" />






  
  <meta property="og:url" content="http://localhost:1313/posts/backing-up-docker-seafile/">
  <meta property="og:site_name" content="000yesnt.github.io">
  <meta property="og:title" content="Properly backing up Docker Seafile&#39;s database">
  <meta property="og:description" content="I wrote this post before I moved away from Seafile. I won’t be updating it, but the commands here should still work as long as Seafile continues to use MySQL/MariaDB.
The Seafile Admin Manual recommends using the following commands to backup your database container:
cd /backup/databases docker exec -it seafile-mysql mariadb-dump -u[username] -p[password] --opt ccnet_db &gt; ccnet_db.sql docker exec -it seafile-mysql mariadb-dump -u[username] -p[password] --opt seafile_db &gt; seafile_db.sql docker exec -it seafile-mysql mariadb-dump -u[username] -p[password] --opt seahub_db &gt; seahub_db.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-04-17T22:21:53-03:00">
    <meta property="article:modified_time" content="2025-04-17T22:21:53-03:00">


  
  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Properly backing up Docker Seafile&#39;s database">
  <meta name="twitter:description" content="I wrote this post before I moved away from Seafile. I won’t be updating it, but the commands here should still work as long as Seafile continues to use MySQL/MariaDB.
The Seafile Admin Manual recommends using the following commands to backup your database container:
cd /backup/databases docker exec -it seafile-mysql mariadb-dump -u[username] -p[password] --opt ccnet_db &gt; ccnet_db.sql docker exec -it seafile-mysql mariadb-dump -u[username] -p[password] --opt seafile_db &gt; seafile_db.sql docker exec -it seafile-mysql mariadb-dump -u[username] -p[password] --opt seahub_db &gt; seahub_db.">


  
  
  <meta itemprop="name" content="Properly backing up Docker Seafile&#39;s database">
  <meta itemprop="description" content="I wrote this post before I moved away from Seafile. I won’t be updating it, but the commands here should still work as long as Seafile continues to use MySQL/MariaDB.
The Seafile Admin Manual recommends using the following commands to backup your database container:
cd /backup/databases docker exec -it seafile-mysql mariadb-dump -u[username] -p[password] --opt ccnet_db &gt; ccnet_db.sql docker exec -it seafile-mysql mariadb-dump -u[username] -p[password] --opt seafile_db &gt; seafile_db.sql docker exec -it seafile-mysql mariadb-dump -u[username] -p[password] --opt seahub_db &gt; seahub_db.">
  <meta itemprop="datePublished" content="2025-04-17T22:21:53-03:00">
  <meta itemprop="dateModified" content="2025-04-17T22:21:53-03:00">
  <meta itemprop="wordCount" content="410">

<meta name="referrer" content="no-referrer-when-downgrade" />

  
  <link href="/original.min.css" rel="stylesheet">

  
    
    <link href="/syntax.min.css" rel="stylesheet">
  

  

  
</head>

<body>
  <header><a class="skip-link" href="#main-content">Skip to main content</a>

<a href="/" class="title"><h1>000yesnt.github.io</h1></a>
<nav>
  <a href="/">Home</a>

  <a href="/posts/">Posts</a>

<a href='http://localhost:1313/index.xml'>RSS</a>







</nav>
</header>
  <main id="main-content">

<h1>Properly backing up Docker Seafile&#39;s database</h1>
<p class="byline">
  <time datetime='2025-04-17' pubdate>
    2025-04-17
  </time>
  
</p>

<content>
  <p><em>I wrote this post before I moved away from Seafile. I won&rsquo;t be updating it, but the commands here
should still work as long as Seafile continues to use MySQL/MariaDB.</em></p>
<hr>
<p>The Seafile Admin Manual <a href="https://manual.seafile.com/latest/administration/backup_recovery/#backing-up-database">recommends using the following commands</a> to backup your database container:</p>





<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>cd /backup/databases
</span></span><span style="display:flex;"><span>docker exec -it seafile-mysql mariadb-dump  -u<span style="color:#f92672">[</span>username<span style="color:#f92672">]</span> -p<span style="color:#f92672">[</span>password<span style="color:#f92672">]</span> --opt ccnet_db &gt; ccnet_db.sql
</span></span><span style="display:flex;"><span>docker exec -it seafile-mysql mariadb-dump  -u<span style="color:#f92672">[</span>username<span style="color:#f92672">]</span> -p<span style="color:#f92672">[</span>password<span style="color:#f92672">]</span> --opt seafile_db &gt; seafile_db.sql
</span></span><span style="display:flex;"><span>docker exec -it seafile-mysql mariadb-dump  -u<span style="color:#f92672">[</span>username<span style="color:#f92672">]</span> -p<span style="color:#f92672">[</span>password<span style="color:#f92672">]</span> --opt seahub_db &gt; seahub_db.sql</span></span></code></pre></div><p>This works, and creates full backups for the main Seafile databases, but there are a few caveats you should be aware of:</p>
<ol>
<li>Original character sets are not saved. <strong>This can cause files with Unicode names to be inacessible</strong>, as well as a few other nasty errors and side effects.</li>
<li>It does not save the MySQL/MariaDB users. This is fine for the root user, but you&rsquo;ll have to manually create the db user after restoring.</li>
<li>You&rsquo;ll have to run a lot of commands to copy, restore and configure a fresh database container.</li>
</ol>
<p>While points 2 and 3 are likely nitpicks, they are still important to me as, in the event of a catastrophic failure that requires a full restore, I&rsquo;d rather spend as little of my own time and effort on recovery as possible.</p>
<h1 id="how-i-do-it">How I do it</h1>
<p>I do not care about whatever benefits splitting the dump in three provides. If <em>any</em> of the databases become corrupted, I think it&rsquo;s a better idea to start fresh instead of possibly causing an invalid, desynced state between databases.</p>
<p>To backup all databases (including the internal <code>mysql</code> database containing user data) to one file, this is the command I use:</p>





<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker exec -it seafile-mysql mariadb-dump -h --username<span style="color:#f92672">=</span>root --password<span style="color:#f92672">=[</span>root_password<span style="color:#f92672">]</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>        --opt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>        --default-character-set<span style="color:#f92672">=</span>utf8mb4 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>        --skip-set-charset <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>        --all-databases <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>        --events <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>        --routines <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>        --triggers <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>        --flush-privileges <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    &gt; /path/to/your/seafile-backup.sql.<span style="color:#e6db74">`</span>date +<span style="color:#e6db74">&#34;%Y-%m-%d-%H-%M-%S&#34;</span><span style="color:#e6db74">`</span></span></span></code></pre></div><p>(Make sure to change <code>mariadb-dump</code> to <code>mysqldump</code> if you&rsquo;re using an older Seafile version!)</p>
<p>What each option does:</p>
<ul>
<li><code>--default-character-set=utf8mb4 --skip-set-charset</code>: Sets the default character set to UTF-8 and suppresses charset reconversion, preventing bugs with Unicode names;</li>
<li><code>--all-databases --events --routines --triggers</code>: Self-explanatory. Gets all databases, their events, routines and triggers;</li>
<li><code>--flush-privileges</code>: Required whenever the dump contains the <code>mysql</code> database (implied by <code>--all-databases</code>). Sends a <code>FLUSH PRIVILEGES</code> statement to the database at the end of the dump.</li>
</ul>
<p>The dump will have the current date appended to it.</p>
<h2 id="recovering">Recovering</h2>
<p>Import it like any other mysql dump.</p>





<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker cp /path/to/your/seafile-backup.sql.2025-04-17-22-21-53 seafile-mysql:/tmp/seafile.sql
</span></span><span style="display:flex;"><span>docker exec -it seafile-mysql /bin/sh -c <span style="color:#e6db74">&#34;mysql -uroot -p[password] &lt; /tmp/seafile.sql&#34;</span></span></span></code></pre></div>
</content>
<p>
  
</p>




  </main>
  <footer><small>
  yesnt (CC BY 4.0) | made with <a href="https://gohugo.io">Hugo</a> and <a href="https://github.com/clente/hugo-bearcub">Bear Cub</a>
</small></footer>

    
</body>

</html>
